{% extends "base.html" %}

{% block title %}Benchmarks - Pipetree Visualizer{% endblock %}

{% block content %}
<div class="p-6 max-w-screen-2xl mx-auto">
    <!-- Header -->
    <div class="flex items-center justify-between mb-4">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">Benchmarks</h1>
            <p class="text-gray-600 text-sm">{{ total_count }} total benchmark{{ 's' if total_count != 1 else '' }}</p>
        </div>
    </div>

    <!-- Filters -->
    <div class="bg-white border border-gray-200 shadow-sm p-3 mb-4 rounded-lg">
        <form id="filter-form" class="flex flex-wrap items-center gap-3">
            <!-- Hidden page input for HTMX requests -->
            <input type="hidden" id="page-input" name="page" value="{{ page }}">

            <div class="flex items-center gap-2">
                <label for="per-page" class="text-sm font-medium text-gray-600">Show:</label>
                <select id="per-page" name="per_page" class="px-2 py-1.5 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
                    <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                    <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
                    <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                    <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
                </select>
            </div>
        </form>
    </div>

    <!-- Benchmarks list with HTMX polling -->
    <div id="benchmarks-list"
         hx-get="/api/benchmarks"
         hx-trigger="every 2s"
         hx-include="#filter-form"
         hx-swap="innerHTML">
        {% include "partials/benchmarks_list.html" %}
    </div>
</div>

<script>
// Page size change
document.getElementById('per-page').addEventListener('change', function() {
    const params = new URLSearchParams(window.location.search);
    params.set('per_page', this.value);
    params.delete('page'); // Reset to page 1
    window.location.href = '/benchmarks?' + params.toString();
});

// Delete benchmark
async function deleteBenchmark(id, dbPath) {
    if (!confirm('Are you sure you want to delete this benchmark? This cannot be undone.')) {
        return;
    }

    try {
        const response = await fetch(`/api/benchmarks/${id}?db=${encodeURIComponent(dbPath)}`, {
            method: 'DELETE'
        });
        const data = await response.json();

        if (data.success) {
            // Trigger HTMX refresh
            htmx.trigger('#benchmarks-list', 'htmx:trigger');
        } else {
            alert('Failed to delete benchmark: ' + (data.error || 'Unknown error'));
        }
    } catch (error) {
        alert('Failed to delete benchmark: ' + error.message);
    }
}
</script>
{% endblock %}
